<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .item-image {
            width: 100px;
            height: auto;
        }
        /* Priority colors */
        .priority-1 { color: #FF6347; }    /* High Priority - Red */
        .priority-2 { color: #FFD700; }    /* Medium Priority - Yellow */
        .priority-3 { color: #90EE90; }    /* Low Priority - Green */
        /* Category colors */
        .category-Clothes { background-color: #FFEFD5; }
        .category-Fitness { background-color: #E0FFFF; }
        .category-Food { background-color: #FFFACD; }
        .category-Games { background-color: #E6E6FA; }
        .category-Kitchen { background-color: #FFB6C1; }
        .category-Makeup { background-color: #FFF0F5; }
        .category-Plushies { background-color: #D8BFD8; }
        .category-Technology { background-color: #B0E0E6; }
        .category-Vinyls { background-color: #FAFAD2; }
        .category-Home { background-color: #FFDAB9; }
    </style>
</head>
<body>
    <h1>Alexis' Christmas List 2024</h1>
    <div class="container">
        <label for="filter">Filter by Category:</label>
        <select id="filter" onchange="loadItems()">
            <option value="">All Categories</option>
            <option value="Clothes">Clothes</option>
            <option value="Fitness">Fitness</option>
            <option value="Food">Food</option>
            <option value="Games">Games</option>
            <option value="Kitchen">Kitchen</option>
            <option value="Makeup">Makeup</option>
            <option value="Plushies">Plushies</option>
            <option value="Technology">Technology</option>
            <option value="Vinyls">Vinyls</option>
            <option value="Home">Home</option>
        </select>
        
        <table id="itemsTable">
            <thead>
                <tr>
                    <th>Priority</th>
                    <th>Category</th>
                    <th>Name</th>
                    <th>Link</th>
                    <th>Price</th>
                    <th>Image</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

    <script>
       function loadItems() {
    const filterValue = document.getElementById('filter').value;
    const url = filterValue 
        ? `/api/items/filter?category=${filterValue}` 
        : '/api/items';
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            const tableBody = document.getElementById('itemsTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = ''; // Clear existing rows

            data.forEach(item => {
                const row = tableBody.insertRow();

                let priorityClass = '';
                if (item.Priority == 1) priorityClass = 'priority-1';
                else if (item.Priority == 2) priorityClass = 'priority-2';
                else if (item.Priority == 3) priorityClass = 'priority-3';

                const categoryClass = `category-${item.Category.replace(/\s+/g, '')}`;
                
                row.innerHTML = `
                    <td class="${priorityClass}">${item.Priority || ''}</td>
                    <td class="${categoryClass}">${item.Category || ''}</td>
                    <td>${item.Item || ''}</td>
                    <td><a href="${item.Link || '#'}" target="_blank">Link</a></td>
                    <td id="price-${item.id}">Loading...</td>
                    <td>${item.Image ? `<img src="${item.Image}" alt="${item.Item} image" class="item-image">` : ''}</td>
                `;

                // Fetch the price for each item and update the price cell
                if (item.Link) {
                    fetchPrice(item.Link, item.id, `price-${item.id}`);
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
}

function fetchPrice(url, itemId, priceElementId) {
    fetch('/api/get_price', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ url: url, item_id: itemId })
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(priceElementId).textContent = data.price || 'Price not available';
    })
    .catch(error => {
        console.error('Error fetching price:', error);
        document.getElementById(priceElementId).textContent = 'Error';
    });
}

window.onload = loadItems;
    </script>    

</body>
</html>